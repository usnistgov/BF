<?xml version="1.0" encoding="utf-8"?>
<BFCVE ID="CVE-2013-4930" Title="Wireshark v1.8.x before v1.8.9 and v1.10.x before v1.10.1 (trace from SARD-231364)" Description="Missing verification on the range for the user-controlled 'len_field' (0, but must be at least 1) results in a wrong value, which becomes a wrong argument for the subtraction ‘-‘ operator in 'len_field-1'. The result is -1 and the sign is flipped; as 'body_len' is unsigned integer, the ‘=’ operator coerces the passed-out result to a distorted value (UINT_MAX), which when used to allocate memory on the heap leads to memory overflow. If exploited, this can lead to denial of service – assertion failure and application exit." Author="Irena Bojanova, Carlos Galhardo" Date="2023-03-29T13:56:28" Criteria="wireshark:wireshark:1.8.0" BugReport="https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=8916" CodeWithBug="https://bugs.wireshark.org/bugzilla/show_bug.cgi?id=8916" CodeWithFix="http://anonsvn.wireshark.org/viewvc?view=revision&amp;amp;amp;revision=50474">
  <DefectWeakness Class="DVR" ClassType="_INP" Language="C" File="wireshark-1.8.0/epan/dissectors/packet-dvbci.c" Trace="" Line="4044">
    <Cause Comment="len_field is 0; must be at least 1" Type="Code">Missing Code</Cause>
    <Operation>Verify</Operation>
    <Consequence Type="Data">Wrong Value</Consequence>
    <Attributes>
      <Operand Name="Data">
        <Attribute Type="State">Stored</Attribute>
      </Operand>
      <Operation>
        <Attribute Comment="len_field must be at least 1" Type="Mechanism">Range</Attribute>
        <Attribute Comment="wireshark-1.8.0/epan/dissectors/packet-dvbci.c : 4044" Type="Source Code">Codebase</Attribute>
        <Attribute Type="Execution Space">Local</Attribute>
      </Operation>
    </Attributes>
  </DefectWeakness>
  <Weakness Class="TCM" ClassType="_DAT" Language="C" File="wireshark-1.8.0/epan/dissectors/packet-dvbci.c" Trace="391, 4071, 4012, 4044" Line="4044">
    <Cause Comment="len_field should be at least 1" Type="Data">Wrong Argument</Cause>
    <Operation Comment="*body_len = len_field-1;">Calculate</Operation>
    <Consequence Comment="(len_field-1) is -1, so the sign is now flipped" Type="Data">Flipped Sign</Consequence>
    <Attributes>
      <Operand Name="Name">
        <Attribute Comment="to body_len" Type="State">Bound</Attribute>
      </Operand>
      <Operand Name="Data">
        <Attribute Comment="0" Type="Kind">Numeric</Attribute>
      </Operand>
      <Operand Name="Type">
        <Attribute Comment="guint32" Type="Kind">Primitive</Attribute>
      </Operand>
      <Operation>
        <Attribute Comment="subtraction '-'" Type="Mechanism">Operator</Attribute>
        <Attribute Comment="wireshark-1.8.0/epan/dissectors/packet-dvbci.c : 4044" Type="Source Code">Codebase</Attribute>
        <Attribute Type="Execution Space">Local</Attribute>
      </Operation>
    </Attributes>
  </Weakness>
  <Weakness Class="TCV" ClassType="_DAT" Language="C" File="wireshark-1.8.0/epan/dissectors/packet-dvbci.c" Trace="391, 4071, 4012, 4044" Line="4044">
    <Cause Type="Data">Flipped Sign</Cause>
    <Operation Comment="*body_len = len_field-1; , where body_len is guint32, but is being assigned a negative number (-1)">Coerce</Operation>
    <Consequence Comment="the large positive integer UINT_MAX" Type="Data">Distorted Value</Consequence>
    <Attributes>
      <Operand Name="Name">
        <Attribute Comment="to body_len" Type="State">Bound</Attribute>
      </Operand>
      <Operand Name="Data">
        <Attribute Comment="-1" Type="Kind">Numeric</Attribute>
      </Operand>
      <Operation>
        <Attribute Comment="assignment '=' operator" Type="Mechanism">Pass Out</Attribute>
        <Attribute Comment="wireshark-1.8.0/epan/dissectors/packet-dvbci.c : 4044" Type="Source Code">Codebase</Attribute>
        <Attribute Type="Execution Space">Local</Attribute>
      </Operation>
    </Attributes>
  </Weakness>
  <Weakness Class="MMN" ClassType="_MEM" Language="C" File="wireshark-1.8.0/epan/reassemble.c" Trace="1691, 1615, 1539, 1208, 1333" Line="1333">
    <Cause Comment="fd-&gt;len set from frag_data_len set from body_len" Type="Data">Wrong Size</Cause>
    <Operation Comment="fd-&gt;data = g_malloc(fd-&gt;len);">Allocate</Operation>
    <Consequence Comment="a large amount of memory is allocated" Type="Memory Corruption/Disclosure">Memory Overflow</Consequence>
    <Attributes>
      <Operand Name="Address">
        <Attribute Type="State">Heap</Attribute>
      </Operand>
      <Operation>
        <Attribute Comment="g_malloc()" Type="Mechanism">Explicit</Attribute>
        <Attribute Comment="wireshark-1.8.0/epan/reassemble.c : 1333" Type="Source Code">Codebase</Attribute>
        <Attribute Type="Execution Space">Userland</Attribute>
      </Operation>
    </Attributes>
  </Weakness>
  <Failures ClassType="_FLR">
    <Cause Comment="" Type="Memory Corruption/Disclosure">Memory Overflow</Cause>
    <Failure Class="DOS" />
  </Failures>
</BFCVE>