---
weight: 1
title: "CVE-2015-0204"
---
# [CVE-2015-0204](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-0204), [1637](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-1637), [1067](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-1067) (FREAK - Factoring attack on RSA-Export Keys)

{{< rawhtml >}}
 <p>
        <h3>BF Taxonomy</h3>
      </p>
      <ul>An inner <u>KMN</u> leads to an inner <u>ENC</u>, which leads to an outer <u>ENC</u>.</ul>

      <ul><u>Inner KMN</u>:</ul>
      <ul><strong>Cause: </strong>
        <cause>Improper Offer of Weak Protocol </cause>(Export RSA – offered from MITM-tricked server and accepted by
        client)
      </ul>
      <ul><strong>Attributes:</strong>
        <ul>Cryptographic Data: <attribute>Keying Material</attribute> (pair of private and public keys)</ul>
        <ul>Data State: <attribute>Transferred </attribute>(over network)</ul>
        <ul>Algorithm: <attribute>Export RSA </attribute> (512-bits key generation based on prime numbers, such that
          private key can be obtained from public key through factorization)</ul>
        <ul><u>Operation</u>: <attribute>Generate</attribute>
        </ul>
      </ul>
      <ul><strong>Consequence: </strong>
        <consequence>IEX Keying Material</consequence> (private key)
      </ul>

      <ul><u>Inner ENC</u>:</ul>
      <ul><strong>Causes: </strong>
        <cause>KMN Fault </cause>leads to <cause>Exposed Private Key</cause>
      </ul>
      <ul><strong>Attributes:</strong>
        <ul>Sensitive Data: <attribute>Cryptographic</attribute> (Pre-Master Secret)</ul>
        <ul>Data State: <attribute>Transferred </attribute>(over network)</ul>
        <ul>Algorithm: <attribute>Asymmetric</attribute> (RSA) (that allows decryption of Pre-Master Secret using
          exposed private key and computation of Master Secret)</ul>
        <ul><u>Security Service</u>: <attribute>Confidentiality</attribute>
        </ul>
      </ul>
      <ul><strong>Consequence: </strong>
        <consequence>IEX of Sensitive Data</consequence> (Master Secret)
      </ul>

      <ul><u>Outer ENC</u>:</ul>
      <ul><strong>Causes: </strong>
        <cause>KMN Fault </cause>leads to <cause>Exposed Secret Key</cause> (Master Secret)
      </ul>
      <ul><strong>Attributes:</strong>
        <ul>Sensitive Data: <attribute>Credentials</attribute> (passwords, credit cards)</ul>
        <ul>Data State: <attribute>Transferred </attribute>(over network)</ul>
        <ul>Algorithm: <attribute>Symmetric</attribute> (key is known) </ul>
        <ul><u>Security Service</u>: <attribute>Confidentiality</attribute>
        </ul>
      </ul>
      <ul><strong>Consequence: </strong>
        <consequence>IEX of Sensitive Data</consequence> (credentials)
      </ul>

      <p>
        <h3>BF Description</h3>
      </p>
      <ul>An inner <u>KMN</u> leads to an inner <u>ENC</u>, which leads to an outer <u>ENC</u>.</ul>
      <ul><u>Inner KMN</u>: <cause>Improper offer of weak protocol</cause> (<attribute>Export RSA</attribute> from
        MITM-tricked server and accepted by client) allows use of 512-bits key <attribute>generation</attribute> (based
        on prime numbers) such that the private key can be obtained from the public key through factorization, which may
        be exploited for <consequence>IEX of keying material</consequence> (private key).</ul>
      <ul><u>Inner ENC</u>: <cause>KMN fault</cause> leads to <cause>exposed private key</cause> for <attribute>
          asymmetric</attribute> encryption (RSA) that allows decryption of <attribute>transferred</attribute> (over
        network) <attribute>cryptographic</attribute> data (Pre-Master Secret) and computation of other <attribute>
          cryptographic</attribute> data (Master Secret), which is <attribute>confidentiality</attribute> failure and
        <consequence>IEX of sensitive data</consequence> (Master Secret).</ul>
      <ul><u>Outer ENC</u>: <cause>KMN fault</cause> leads to <cause>exposed secret key</cause> (Master Secret) for
        <attribute>symmetric</attribute> encryption allows decryption of <attribute>credentials</attribute> (passwords,
        credit cards, etc.) <attribute>transferred</attribute> (over network), which is <attribute>confidentiality
        </attribute> failure and <consequence>IEX of sensitive data</consequence> (passwords, credit cards, etc.). <a
          href="#ref">[1]</a></ul>

      <p>
        <h3>CVE Descriptions</h3>
      </p>
      <p>
      <ul>"The ssl3_get_key_exchange function in s3_clnt.c in OpenSSL before 0.9.8zd, 1.0.0 before 1.0.0p, and 1.0.1
        before 1.0.1k allows remote SSL servers to conduct RSA-to-EXPORT_RSA downgrade attacks and facilitate
        brute-force decryption by offering a weak ephemeral RSA key in a noncompliant role, related to the "FREAK"
        issue. NOTE: the scope of this CVE is only client code based on OpenSSL, not EXPORT_RSA issues associated with
        servers or other TLS implementations." <a href="#ref">[4]</a></ul>
      </p>
      <p>
      <ul>"Schannel (aka Secure Channel) in Microsoft Windows Server 2003 SP2, Windows Vista SP2, Windows Server 2008
        SP2 and R2 SP1, Windows 7 SP1, Windows 8, Windows 8.1, Windows Server 2012 Gold and R2, and Windows RT Gold and
        8.1 does not properly restrict TLS state transitions, which makes it easier for remote attackers to conduct
        cipher-downgrade attacks to EXPORT_RSA ciphers via crafted TLS traffic, related to the "FREAK" issue, a
        different vulnerability than CVE-2015-0204 and CVE-2015-1067." <a href="#ref">[5]</a></ul>
      </p>
      <p>
      <ul>"Secure Transport in Apple iOS before 8.2, Apple OS X through 10.10.2, and Apple TV before 7.1 does not
        properly restrict TLS state transitions, which makes it easier for remote attackers to conduct cipher-downgrade
        attacks to EXPORT_RSA ciphers via crafted TLS traffic, related to the "FREAK" issue, a different vulnerability
        than CVE-2015-0204 and CVE-2015-1637." <a href="#ref">[6]</a></ul>
      </p>

      <p>
        <h3>Analysis</h3>
      </p>
      <p>
      <ul>The following analysis is based on information in <a href="#ref">[7, 8, 9, 10]</a>: The server offers a weak
        protocol (Export RSA) while the client requested strong protocol (RSA).
      </ul>
      <ul>Communication is encrypted by symmetric encryption. The key for that encryption (Master Secret) is created by
        both client and server from a Pre-Master Secret and nonces sent by client and server. The Pre-Master Secret is
        sent encrypted by RSA cryptosystem. The client requests RSA protocol, but man in the middle (MITM) intercepts
        and requests Export RSA that uses a 512 bit key. Factoring a 512 bit RSA key is feasible.</ul>
      <ul>Because of a bug, the client agrees to Export RSA. MITM factors the public 512 bit public RSA key, uses this
        factoring to recover the private RSA key, and then uses that private key to decrypt the Pre-Master Secret. Then
        it uses the Pre-Master Secret and the nonces to generate the Master Secret. The Master Secret enables MITM to
        decrypt the encrypted communication from that point on. </ul>
      </p>
      <p>
        <h3>Source Code</h3>
      </p>
      <p>
      <ul>
        <table align="center" class="table-responsive">
          <tr>
            <td align="center"> FREAK Client Code With Bug</td>

          <tr>
            <td>
              <div class="">
                <table>
                  <tr>
                    <td>
                      <pre style="margin: 0; line-height: 125%">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
</pre>
                    </td>
                    <td>
                      <pre style="margin: 0; line-height: 125%">#<keyword>ifndef</keyword> OPENSSL_NO_RSA
  <keyword>if</keyword> (alg_k <span style="color: #333333">&amp;</span> SSL_kRSA)
    {







      <keyword>if</keyword> ((rsa<span style="color: #333333">=</span><keyword>RSA_new</keyword>()) <span style="color: #333333">==</span> <span style="color: #007020"><keyword>NULL</keyword></span>)
        {
          <keyword>SSLerr</keyword>(SSL_F_SSL3_GET_KEY_EXCHANGE,ERR_R_MALLOC_FAILURE);
</pre>
                    </td>
                  </tr>
                </table>
              </div>
            </td>


          </tr>
          <td align="center"> FREAK Client Code With Fix</td>
          <tr>

            <td>
              <div class="" style="width:auto;">
                <table>
                  <tr>
                    <td>
                      <pre style="margin: 0; line-height: 125%">  1
  2
  3
  <span class="addLine">4
  5
  6
  7
  8
  9
 10</span>
 11
 12
 13
</pre>
                    </td>
                    <td>
                      <pre style="margin: 0; line-height: 125%">#<keyword>ifndef</keyword> OPENSSL_NO_RSA
    <keyword>if</keyword> (alg_k <span style="color: #333333">&amp;</span> SSL_kRSA)
     {
        <comment>/* Temporary RSA keys only allowed in export ciphersuites */</comment>
        <keyword>if</keyword> (!<keyword>SSL_C_IS_EXPORT</keyword>(s<span style="color: #333333">-&gt;s3<span style="color: #333333">-&gt;</span>tmp.new_cipher))
          {
  	  al<span style="color: #333333">=</span>SSL_AD_UNEXPECTED_MESSAGE;
            <keyword>SSLerr</keyword>(SSL_F_SSL3_GET_SERVER_CERTIFICATE,SSL_R_UNEXPECTED_MESSAGE);
            <keyword>goto</keyword> f_err;
          }
        <keyword>if</keyword> ((rsa<span style="color: #333333">=</span><keyword>RSA_new</keyword>()) <span style="color: #333333">==</span> <span style="color: #007020"><keyword>NULL</keyword></span>)
          {
            <keyword>SSLerr</keyword>(SSL_F_SSL3_GET_KEY_EXCHANGE,ERR_R_MALLOC_FAILURE);</pre>
                    </td>
                  </tr>
                </table>
              </div>
            </td>
          </tr>
          <td align="center" style="padding-top: 25px;"> FREAK Server Code With Bug</td>
          <tr>

            <td>
              <div class="">
                <table>
                  <tr>
                    <td>
                      <pre style="margin: 0; line-height: 125%">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
</pre>
                    </td>
                    <td>
                      <pre style="margin: 0; line-height: 125%">  <keyword>case</keyword> SSL3_ST_SW_KEY_EXCH_B:
    alg_k <span style="color: #333333">=</span> s<span style="color: #333333">-&gt;</span>s3<span style="color: #333333">-&gt;</span>tmp.new_cipher<span style="color: #333333">-&gt;</span>algorithm_mkey;
    <comment>/* clear this, it may get reset by send_server_key_exchange */</comment>
    <keyword>if</keyword> ((s<span style="color: #333333">-&gt;</span>options <span style="color: #333333">&amp;</span> SSL_OP_EPHEMERAL_RSA)
#<keyword>ifndef</keyword> OPENSSL_NO_KRB5
      <span style="color: #333333">&amp;&amp;</span> <span style="color: #333333">!</span>(alg_k <span style="color: #333333">&amp;</span> SSL_kKRB5)
#<keyword>endif</keyword> <span style="color: #888888">/* OPENSSL_NO_KRB5 */</span><span style="color: #557799"></span>)
      <span style="color: #888888">/* option SSL_OP_EPHEMERAL_RSA sends temporary RSA key even when forbidden</span>
      <span style="color: #888888"> * by protocol specs (handshake may fail as clients are not required to</span>
      <span style="color: #888888"> * be able to handle this) */</span>
      s<span style="color: #333333">-&gt;</span>s3<span style="color: #333333">-&gt;</span>tmp.use_rsa_tmp<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">1</span>;
    <keyword>else</keyword>
      s<span style="color: #333333">-&gt;</span>s3<span style="color: #333333">-&gt;</span>tmp.use_rsa_tmp<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">0</span>;
    <keyword>if</keyword> (s->s3->tmp.use_rsa_tmp</pre>
                    </td>
                  </tr>
                </table>
              </div>
            </td>
          </tr>
          <td align="center"> FREAK Server Code With Fix</td>
          <tr>

            <td>
              <div class="">
                <table>
                  <tr>
                    <td>
                      <pre style="margin: 0; line-height: 125%">  1
  2
  3
  <span class="addLine">4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14</span>
</pre>
                    </td>
                    <td>
                      <pre style="margin: 0; line-height: 125%">  <keyword>case</keyword> SSL3_ST_SW_KEY_EXCH_B:
    alg_k <span style="color: #333333">=</span> s<span style="color: #333333">-&gt;</span>s3<span style="color: #333333">-&gt;</span>tmp.new_cipher<span style="color: #333333">-&gt;</span>algorithm_mkey;
    <comment>/* clear this, it may get reset by send_server_key_exchange */</comment>
    s<span style="color: #333333">-&gt;</span>s3<span style="color: #333333">-&gt;</span>tmp.use_rsa_tmp<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">0</span>;









   <keyword>if</keyword> (</pre>
                    </td>
                  </tr>
                </table>
              </div>
            </td>
          </tr>
        </table>
      </ul>
      </p>

<p class="">
        <h3><a name="ref">References</a></h3>
      </p>
      <small>
        <ul>[1] Bojanova, I., Black, P. E., Yesha, Y., Wu, Yan, Evans, Z., Poster: The Bugs Framework (BF) – First
          Classes: Buffer Overflow (BOF), Injection (INJ), Control of Interaction Frequency (CIF), STC 2017, NIST,
          Gaithersburg, MD, USA.</ul>
        <ul>[2] The MITRE Corporation, <a target="_blank"
            href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-1919">CVE-2016-1919</a>.</ul>
        <ul>[3] openwall.net, [CVE-2016-1919] "<a target="_blank"
            href="http://lists.openwall.net/bugtraq/2016/01/17/2">Weak eCryptFS Key generation from user password</a>."
        </ul>
        <ul>[4] The MITRE Corporation, <a target="_blank"
            href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2015-0204">CVE-2015-0204</a>.</ul>
        <ul>[5] The MITRE Corporation, <a target="_blank"
            href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-1637">CVE-2015-1637</a>.</ul>
        <ul>[6] The MITRE Corporation, <a target="_blank"
            href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-1067">CVE-2015-1067</a>.</ul>
        <ul>[7] R. Heaton, "<a target="_blank"
            href="https://robertheaton.com/2015/04/06/the-ssl-freak-vulnerability/">The SSL FREAK vulnerability
            explained</a>."</ul>
        <ul>[8] Censys, <a target="_blank" href="https://censys.io/blog/freak">The FREAK Attack</a>.</ul>
        <ul>[9] StackExchange, <a target="_blank"
            href="https://android.stackexchange.com/questions/101929/protecting-phone-from-the-freak-bug/101966">Protecting
            phone from the FREAK bug</a>.</ul>
        <ul>[10] GitHub, openssl, <a target="_blank"
            href="https://github.com/openssl/openssl/commit/ce325c60c74b0fa784f5872404b722e120e5cab0?diff=split">Only
            allow ephemeral RSA keys in export ciphersuites</a>.</ul>
      </small>
      {{< /rawhtml >}}